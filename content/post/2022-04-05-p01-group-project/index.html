---
title: 'P01: Group Project '
author: R package build
date: '2022-04-05'
slug: p01-group-project
categories: []
tags: []
---

<script src="{{< blogdown/postref >}}index_files/header-attrs/header-attrs.js"></script>


<div id="jenna-leali-project" class="section level2">
<h2>Jenna Leali Project</h2>
</div>
<div id="load-library" class="section level2">
<h2>Load Library</h2>
<pre class="r"><code>library(plyr)
library(corrplot)</code></pre>
<pre><code>## corrplot 0.92 loaded</code></pre>
<pre class="r"><code>library(ggplot2)
library(gridExtra)
library(ggthemes)
library(caret)</code></pre>
<pre><code>## Loading required package: lattice</code></pre>
<pre class="r"><code>library(MASS)
library(randomForest)</code></pre>
<pre><code>## randomForest 4.7-1</code></pre>
<pre><code>## Type rfNews() to see new features/changes/bug fixes.</code></pre>
<pre><code>## 
## Attaching package: &#39;randomForest&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:gridExtra&#39;:
## 
##     combine</code></pre>
<pre><code>## The following object is masked from &#39;package:ggplot2&#39;:
## 
##     margin</code></pre>
<pre class="r"><code>library(party)</code></pre>
<pre><code>## Loading required package: grid</code></pre>
<pre><code>## Loading required package: mvtnorm</code></pre>
<pre><code>## Loading required package: modeltools</code></pre>
<pre><code>## Loading required package: stats4</code></pre>
<pre><code>## 
## Attaching package: &#39;modeltools&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:plyr&#39;:
## 
##     empty</code></pre>
<pre><code>## Loading required package: strucchange</code></pre>
<pre><code>## Loading required package: zoo</code></pre>
<pre><code>## 
## Attaching package: &#39;zoo&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     as.Date, as.Date.numeric</code></pre>
<pre><code>## Loading required package: sandwich</code></pre>
</div>
<div id="import-data" class="section level2">
<h2>Import Data</h2>
<pre class="r"><code>bank.churn &lt;- read.csv(&quot;https://raw.githubusercontent.com/JennaLeali/JennaLealisWebsite/main/Bank_Churn.csv&quot;)</code></pre>
</div>
<div id="summary-of-data" class="section level2">
<h2>Summary of Data</h2>
<pre class="r"><code>summary(bank.churn)</code></pre>
<pre><code>##    RowNumber       CustomerId        CreditScore     Geography        
##  Min.   :    1   Min.   :15565701   Min.   :350.0   Length:10000      
##  1st Qu.: 2501   1st Qu.:15628528   1st Qu.:584.0   Class :character  
##  Median : 5000   Median :15690738   Median :652.0   Mode  :character  
##  Mean   : 5000   Mean   :15690941   Mean   :650.5                     
##  3rd Qu.: 7500   3rd Qu.:15753234   3rd Qu.:718.0                     
##  Max.   :10000   Max.   :15815690   Max.   :850.0                     
##     Gender               Age            Tenure          Balance      
##  Length:10000       Min.   :18.00   Min.   : 0.000   Min.   :     0  
##  Class :character   1st Qu.:32.00   1st Qu.: 3.000   1st Qu.:     0  
##  Mode  :character   Median :37.00   Median : 5.000   Median : 97199  
##                     Mean   :38.92   Mean   : 5.013   Mean   : 76486  
##                     3rd Qu.:44.00   3rd Qu.: 7.000   3rd Qu.:127644  
##                     Max.   :92.00   Max.   :10.000   Max.   :250898  
##  NumOfProducts    HasCrCard      IsActiveMember   EstimatedSalary    
##  Min.   :1.00   Min.   :0.0000   Min.   :0.0000   Min.   :    11.58  
##  1st Qu.:1.00   1st Qu.:0.0000   1st Qu.:0.0000   1st Qu.: 51002.11  
##  Median :1.00   Median :1.0000   Median :1.0000   Median :100193.91  
##  Mean   :1.53   Mean   :0.7055   Mean   :0.5151   Mean   :100090.24  
##  3rd Qu.:2.00   3rd Qu.:1.0000   3rd Qu.:1.0000   3rd Qu.:149388.25  
##  Max.   :4.00   Max.   :1.0000   Max.   :1.0000   Max.   :199992.48  
##      Exited      
##  Min.   :0.0000  
##  1st Qu.:0.0000  
##  Median :0.0000  
##  Mean   :0.2037  
##  3rd Qu.:0.0000  
##  Max.   :1.0000</code></pre>
<pre class="r"><code>head(bank.churn)</code></pre>
<pre><code>##   RowNumber CustomerId CreditScore Geography Gender Age Tenure   Balance
## 1         1   15634602         619    France Female  42      2      0.00
## 2         2   15647311         608     Spain Female  41      1  83807.86
## 3         3   15619304         502    France Female  42      8 159660.80
## 4         4   15701354         699    France Female  39      1      0.00
## 5         5   15737888         850     Spain Female  43      2 125510.82
## 6         6   15574012         645     Spain   Male  44      8 113755.78
##   NumOfProducts HasCrCard IsActiveMember EstimatedSalary Exited
## 1             1         1              1       101348.88      1
## 2             1         0              1       112542.58      0
## 3             3         1              0       113931.57      1
## 4             2         0              0        93826.63      0
## 5             1         1              1        79084.10      0
## 6             2         1              0       149756.71      1</code></pre>
<pre class="r"><code>str(bank.churn)</code></pre>
<pre><code>## &#39;data.frame&#39;:    10000 obs. of  13 variables:
##  $ RowNumber      : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ CustomerId     : int  15634602 15647311 15619304 15701354 15737888 15574012 15592531 15656148 15792365 15592389 ...
##  $ CreditScore    : int  619 608 502 699 850 645 822 376 501 684 ...
##  $ Geography      : chr  &quot;France&quot; &quot;Spain&quot; &quot;France&quot; &quot;France&quot; ...
##  $ Gender         : chr  &quot;Female&quot; &quot;Female&quot; &quot;Female&quot; &quot;Female&quot; ...
##  $ Age            : int  42 41 42 39 43 44 50 29 44 27 ...
##  $ Tenure         : int  2 1 8 1 2 8 7 4 4 2 ...
##  $ Balance        : num  0 83808 159661 0 125511 ...
##  $ NumOfProducts  : int  1 1 3 2 1 2 2 4 2 1 ...
##  $ HasCrCard      : int  1 0 1 0 1 1 1 1 0 1 ...
##  $ IsActiveMember : int  1 1 0 0 1 0 1 0 1 1 ...
##  $ EstimatedSalary: num  101349 112543 113932 93827 79084 ...
##  $ Exited         : int  1 0 1 0 0 1 0 1 0 0 ...</code></pre>
</div>
<div id="remove-rows-with-missing-values" class="section level2">
<h2>Remove Rows with Missing Values</h2>
<pre class="r"><code>sapply(bank.churn, function(x) sum(is.na(x)))</code></pre>
<pre><code>##       RowNumber      CustomerId     CreditScore       Geography          Gender 
##               0               0               0               0               0 
##             Age          Tenure         Balance   NumOfProducts       HasCrCard 
##               0               0               0               0               0 
##  IsActiveMember EstimatedSalary          Exited 
##               0               0               0</code></pre>
<pre class="r"><code>bank.churn &lt;- bank.churn[complete.cases(bank.churn), ]</code></pre>
</div>
<div id="data-wrangling" class="section level2">
<h2>Data Wrangling</h2>
<div id="change-the-values-in-columns-hascrcard-isactivemember-and-exited-from-0-or-1-to-no-or-yes" class="section level4">
<h4>Change the values in columns “HasCrCard”, “IsActiveMember”, and “Exited” from 0 or 1 to “No” or “Yes”</h4>
<pre class="r"><code>bank.churn$HasCrCard &lt;- as.factor(mapvalues(bank.churn$HasCrCard,
                                      from=c(&quot;0&quot;,&quot;1&quot;),
                                      to=c(&quot;No&quot;, &quot;Yes&quot;)))</code></pre>
<pre class="r"><code>bank.churn$IsActiveMember &lt;- as.factor(mapvalues(bank.churn$IsActiveMember,
                                      from=c(&quot;0&quot;,&quot;1&quot;),
                                      to=c(&quot;No&quot;, &quot;Yes&quot;)))</code></pre>
<pre class="r"><code>bank.churn$Exited &lt;- as.factor(mapvalues(bank.churn$Exited,
                                      from=c(&quot;0&quot;,&quot;1&quot;),
                                      to=c(&quot;No&quot;, &quot;Yes&quot;)))</code></pre>
</div>
<div id="group-tenure-by-years" class="section level4">
<h4>Group Tenure by Years</h4>
<pre class="r"><code>min(bank.churn$Tenure); max(bank.churn$Tenure)</code></pre>
<pre><code>## [1] 0</code></pre>
<pre><code>## [1] 10</code></pre>
<pre class="r"><code>group_tenure &lt;- function(Tenure){
    if (Tenure &gt;= 0 &amp; Tenure &lt;= 2){
        return(&#39;0-2 Years&#39;)
    }else if(Tenure &gt; 2 &amp; Tenure &lt;= 4){
        return(&#39;2-4 Years&#39;)
    }else if (Tenure &gt; 4 &amp; Tenure &lt;= 6){
        return(&#39;4-6 Years&#39;)
    }else if (Tenure &gt; 6 &amp; Tenure &lt;=8){
        return(&#39;6-8 Years&#39;)
    }else if (Tenure &gt; 8){
        return(&#39;&gt; 8 Years&#39;)
    }
}

bank.churn$tenure_group &lt;- sapply(bank.churn$Tenure,group_tenure)
bank.churn$tenure_group &lt;- as.factor(bank.churn$tenure_group)</code></pre>
</div>
<div id="remove-columns-not-needed-for-analysis" class="section level4">
<h4>Remove columns not needed for analysis</h4>
<pre class="r"><code>bank.churn$customerID &lt;- NULL
bank.churn$tenure &lt;- NULL</code></pre>
</div>
</div>
<div id="exploratory-data-analysis" class="section level2">
<h2>Exploratory Data Analysis</h2>
<div id="bar-plots-of-categorical-variables" class="section level4">
<h4>Bar plots of categorical variables</h4>
<pre class="r"><code>p1 &lt;- ggplot(bank.churn, aes(x=Gender)) + ggtitle(&quot;Gender&quot;) + xlab(&quot;Gender&quot;) +
  geom_bar(aes(y = 100*(..count..)/sum(..count..)), width = 0.5) + ylab(&quot;Percentage&quot;) + coord_flip() + theme_minimal()
p2 &lt;- ggplot(bank.churn, aes(x=Geography)) + ggtitle(&quot;Geography&quot;) + xlab(&quot;Geography&quot;) + 
  geom_bar(aes(y = 100*(..count..)/sum(..count..)), width = 0.5) + ylab(&quot;Percentage&quot;) + coord_flip() + theme_minimal()
p3 &lt;- ggplot(bank.churn, aes(x=HasCrCard)) + ggtitle(&quot;Has Credit Card&quot;) + xlab(&quot;Has Credit Card&quot;) + 
  geom_bar(aes(y = 100*(..count..)/sum(..count..)), width = 0.5) + ylab(&quot;Percentage&quot;) + coord_flip() + theme_minimal()
p4 &lt;- ggplot(bank.churn, aes(x=IsActiveMember)) + ggtitle(&quot;Is Active Member&quot;) + xlab(&quot;Is Active Member&quot;) +
  geom_bar(aes(y = 100*(..count..)/sum(..count..)), width = 0.5) + ylab(&quot;Percentage&quot;) + coord_flip() + theme_minimal()
p5 &lt;- ggplot(bank.churn, aes(x=Exited)) + ggtitle(&quot;Has Closed Account&quot;) + xlab(&quot;Has Closed Account&quot;) +
  geom_bar(aes(y = 100*(..count..)/sum(..count..)), width = 0.5) + ylab(&quot;Percentage&quot;) + coord_flip() + theme_minimal()
p6 &lt;- ggplot(bank.churn, aes(x=tenure_group)) + ggtitle(&quot;Tenure Group&quot;) + xlab(&quot;Tenure Group&quot;) +
  geom_bar(aes(y = 100*(..count..)/sum(..count..)), width = 0.5) + ylab(&quot;Percentage&quot;) + coord_flip() + theme_minimal()
grid.arrange(p1, p2, p3, p4, p5, p6, ncol=3)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
</div>
</div>
<div id="balance-the-dataset-before-modeling" class="section level2">
<h2>Balance the dataset before modeling</h2>
<div id="load-library-1" class="section level4">
<h4>Load Library</h4>
<pre class="r"><code>library(ggplot2)
library(knitr)
suppressMessages(library(dplyr))
suppressMessages(library(unbalanced))</code></pre>
</div>
<div id="intial-look-at-the-data" class="section level4">
<h4>Intial look at the data</h4>
<div id="converted-exited-to-factor" class="section level5">
<h5>Converted exited to factor</h5>
<pre class="r"><code>bank.churn$Class&lt;-as.factor(bank.churn$Exited) 
levels(bank.churn$Exited) &lt;- c(&#39;Loyal&#39;, &#39;Closed&#39;) 
summary(bank.churn$Exited)</code></pre>
<pre><code>##  Loyal Closed 
##   7963   2037</code></pre>
</div>
<div id="plotting-number-of-samples-in-each-class" class="section level5">
<h5>Plotting number of samples in each class</h5>
<pre class="r"><code>options(scipen=10000) 

ggplot(data = bank.churn, aes(fill = Exited)) +
    geom_bar(aes(x = Exited))+
    ggtitle(&quot;Has customer closed the bank account or a loyal customer&quot;, subtitle = &quot;Original dataset&quot;)+
    xlab(&quot;&quot;)+
    ylab(&quot;Samples&quot;)+
    scale_y_continuous(expand = c(0,0))+
    scale_x_discrete(expand = c(0,0))+
    theme(legend.position = &quot;none&quot;, 
         legend.title = element_blank(),
         panel.grid.major = element_blank(),
         panel.grid.minor = element_blank(),
         panel.background = element_blank())</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-17-1.png" width="672" />
##### Scatter plot of orginal dataset (NEEDS WORK)</p>
<pre class="r"><code>ggplot(data = bank.churn, aes(x = Tenure, y = CustomerId, colour = Exited))+
  geom_point()+
    ggtitle(&quot;Original dataset&quot;)+
    xlab(&quot;V4&quot;)+
    ylab(&quot;V7&quot;)+
    geom_point() +
    xlim(-5, 15)+
    ylim(-50, 50)+
    theme(panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
          panel.background = element_blank(), 
          legend.key=element_blank())</code></pre>
<pre><code>## Warning: Removed 10000 rows containing missing values (geom_point).
## Removed 10000 rows containing missing values (geom_point).</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
</div>
<div id="seperating-the-data-into-the-predictor-variable-and-the-response-variable-may-not-be-13" class="section level5">
<h5>Seperating the data into the predictor variable and the response variable (MAY NOT BE 13)</h5>
<pre class="r"><code>predictor_variables &lt;- bank.churn[,-13] 
response_variable &lt;- bank.churn$Exited   </code></pre>
</div>
<div id="minority-case-must-be-have-the-factor-level-of-1-default-has-it-coded-as-0" class="section level5">
<h5>Minority case must be have the factor level of 1, default has it coded as 0</h5>
<pre class="r"><code>levels(response_variable) &lt;- c(&#39;0&#39;, &#39;1&#39;)</code></pre>
</div>
</div>
<div id="run-undersampled-function" class="section level3">
<h3>Run undersampled function</h3>
<pre class="r"><code>undersampled_data &lt;- ubBalance(predictor_variables, 
                               response_variable, 
                               type=&#39;ubUnder&#39;,         
                               verbose = TRUE)</code></pre>
<pre><code>## Proportion of positives after ubUnder : 50 % of 4074 observations</code></pre>
<pre class="r"><code>undersampled_combined &lt;- cbind(undersampled_data$X,    
                               undersampled_data$Y)

names(undersampled_combined)[names(undersampled_combined) == &quot;undersampled_data$Y&quot;] &lt;- &quot;Exited&quot; 
levels(undersampled_combined$Exited) &lt;- c(&#39;Loyal&#39;, &#39;Closed&#39;)</code></pre>
<div id="plot-number-of-cases-in-undersampled-dataset" class="section level5">
<h5>Plot number of cases in undersampled dataset</h5>
<pre class="r"><code>ggplot(data = undersampled_combined, aes(fill = Exited))+
    geom_bar(aes(x = Exited))+
    ggtitle(&quot;Number customer who closed the bank account or remained a loyal customer after undersampling&quot;, 
            subtitle=&quot;Total samples: 4074&quot;)+
     xlab(&quot;&quot;)+
     ylab(&quot;Samples&quot;)+
     scale_y_continuous(expand = c(0,0))+
     scale_x_discrete(expand = c(0,0))+
     theme(legend.position = &quot;none&quot;, 
           legend.title = element_blank(),
           panel.grid.major = element_blank(),
           panel.grid.minor = element_blank(),
           panel.background = element_blank())</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-23-1.png" width="672" />
##### Scatter plot of undersampled data (NEED TO FIX WHAT GOES ON X AND Y)</p>
<pre class="r"><code>ggplot(data = undersampled_combined, aes(x = Tenure, y = CustomerId, colour = Exited))+
  geom_point()+
    ggtitle(&quot;Undersampled dataset&quot;)+
    xlab(&quot;V4&quot;)+
    ylab(&quot;V7&quot;)+
    xlim(-5, 15)+
    ylim(-50, 50)+
    theme(panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
          panel.background = element_blank(), 
          legend.key=element_blank())</code></pre>
<pre><code>## Warning: Removed 4074 rows containing missing values (geom_point).</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
</div>
</div>
</div>
<div id="build-a-logistic-regression-model" class="section level2">
<h2>Build a Logistic Regression model</h2>
<div id="fitting-the-logistic-regression-model" class="section level5">
<h5>Fitting the logistic regression model</h5>
</div>
</div>
